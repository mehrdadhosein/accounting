<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:custom="http://seraj.com/seraj/facelet"
	xmlns:t="http://myfaces.apache.org/tomahawk">


			
		<script type='text/javascript'	src='${request.contextPath}/dwr/interface/#{dwrFormName}.js?p=21'> </script>
		<script type='text/javascript'	src='${request.contextPath}/common/sanadHesabdari.gridNew.js?p=21'> </script>
<style>
.dialogViewLableCol {
	text-align: left;
	width: 33%;
	vertical-align: middle;
	font-family: tahoma;
	color: gray;
	font-size: 12px;
	padding-left: 10px;
}
</style>
<t:div id="sanadHesabdariDialog" forceId="true" style="display:none">
	<t:panelGrid columns="2" width="90%"
		columnClasses="dialogViewLableCol,inputCol" styleClass="inputForm">

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="hesabTafsili"
				value="#{messages['SanadHesabdariItem_hesabTafsili']}" /> : 
		</h:panelGroup>
		<h:panelGroup>
			<input type="text" style="width: 200px;" name="hesabTafsiliName" id="hesabTafsiliName" onclick="openHesabModal();"/>
			<input type="hidden" name="hesabTafsiliID" id="hesabTafsiliID"/>
		</h:panelGroup>


		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="bestankar" value="#{messages['SanadHesabdariItem_bestankar']}" /> : 
		</h:panelGroup>
		<input type="text" style="width: 200px;" name="bestankar" id="bestankar" />

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="bedehkar"
				value="#{messages['SanadHesabdariItem_bedehkar']}" /> : 
		</h:panelGroup>
		<input type="text" style="width: 200px;" name="bedehkar" id="bedehkar" />



		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="description" value="#{messages['SanadHesabdariItem_description']}" /> : 
		</h:panelGroup>
		<textarea  name="description" id="description" rows="5"  style="width: 200px;"/>
			

	</t:panelGrid>
</t:div>
	    <div style="display:none;left:30%;position:fixed;width:80%;height:85%;overflow:scroll" class="modal hide" id="hesabLov">
		    <div class="modal-header">
			    <a class="close" data-dismiss="modal" style="margin:0 5px 0 15px"><img src="${request.contextPath}/images/remove.png" border="0"/></a>
			    #{messages['HesabTafsili_list']}
		    </div>
		    <div class="modal-body">
			   <iframe width="100%" frameborder="0"  height="350" src="${request.contextPath}/hesabtafsili/hesabTafsili.lov.modal.jsf">
			   
			   </iframe>
		    </div>
		    <div class="modal-footer">
		    </div>
	    </div>  
<table id="sanadHesabdariGrid">
	<tr>
		<td>&nbsp;</td>
	</tr>
</table>
<div id="sanadHesabdariPcustbut"></div>
<t:jsValueSet name="bankBranchMap" value="#{bank.bankBranchMap}" />

<script type="text/javascript">

function fillDest(kala,unit){
	var kalaId = $$('#kala_id').val();
	
	if(kalaId == null)
		return;
	clearAutocomplete(unit);
	unitMap = kalaUnitMap[kalaId];
	//alert("unitMap : "+unitMap.length);
	var filtered = unitMap;
	//alert(inspect(filtered,10,10));
	 $$('#unit_desc').autocomplete("option","source",filtered);
}

function openHesabModal(){
	$$('#hesabLov').modal('show');
}

function setTafsili(id,desc){
	document.getElementById("hesabTafsiliName").value=desc;
	document.getElementById("hesabTafsiliID").value=id;
	$$('#hesabLov').modal('hide');
}
</script>

<script type="text/javascript">
		setGridGlobalRowId('sanadHesabdariGrid',0);
		var lastRow = -1; 
		function createSanadHesabdariGrid(gridJsonData) { 		
	$$('#sanadHesabdariGrid')
			.jqGrid(
					{
						direction :'rtl',
			            datatype: 'jsonstring',
			            datastr: gridJsonData,
						height: '100%',
			            shrinkToFit: true,
						colNames : [
									'#{messages['common_id']}', 
									'#{messages['common_id']}', 
									'#{messages['SanadHesabdariItem_hesabTafsili']}', 
									'#{messages['SanadHesabdariItem_bestankar']}', 
									'#{messages['SanadHesabdariItem_bedehkar']}', 
									'#{messages['SanadHesabdariItem_description']}', 
									'#{messages['common_delete']}', 
									'#{messages['common_edit']}' 
									],
						colModel : [ 
							{name :'id', index :'id', width :2, sorttype :'int'}, 
							{name :'hesabTafsiliID', index :'hesabTafsiliID', width :2, sorttype :'string'}, 
							{name :'hesabTafsiliName', index :'hesabTafsiliName', width :100, sorttype :'string'}, 
							{name :'bestankar', index :'bestankar', width :150, sortable :false, editable:true}, 
							{name :'bedehkar', index :'bedehkar', width :150, sortable :false, editable:true}, 
							{name :'description', index :'description', width :150, sortable :false, editable:true}, 
							{name :'act', index :'act', width :30, sortable :false}, 
							{name :'editAct', index :'editAct', width :45, sortable :false}
						],
						multiselect :false,
						viewrecords: true, 
						autowidth: false, 
						pager: '#sanadHesabdariPcustbut',
						rowNum:50, 
						rownumbers: true,
						sortname: 'kalaName', 
						onSelectRow: function(id){ 
							$$('#sanadHesabdariGrid').jqGrid('editRow',id,true);
							if(lastRow != -1)if(id!=lastRow) 
								$$('#sanadHesabdariGrid').jqGrid('saveRow',lastRow, false, 'clientArray');
							lastRow=id;   
						}, 
						caption :'#{messages['SanadHesabdariItem_list']}'
					});
	$$('#sanadHesabdariGrid').jqGrid('navGrid','#sanadHesabdariPcustbut',{edit:false,add:false,del:false,search:false,page:false, searchtext:'#{messages['common_search']}'}); 
	$$('#sanadHesabdariGrid').jqGrid('navButtonAdd','#sanadHesabdariPcustbut',{caption:'#{messages['common_new']}', 
		onClickButton:function(){ 
			clearSanadHesabdariDialog('#sanadHesabdariGrid');
			$$('#sanadHesabdariDialog').dialog({title:'#{messages['SanadHesabdariItem_title']}', width: '60%', autoOpen: true,buttons: { '#{messages['common_close']}': function() { $$(this).dialog('close'); },'#{messages['common_add']}': function() { addSanadHesabdariRowData('#sanadHesabdariGrid');$$(this).dialog('close'); }}});
		} 
	});

//	var gridItems=new Array('radif','kala_id','kala_desc','unit_id','unit_desc','country_id','country_desc','procurementOrgan_id','procurementOrgan_desc','meghdarDarkhasti','meghdarTahvili',
//			'kalaQuality','meghdarBargashti_saalem','meghdarBargashti_kharab','mahaleEstefadeh','expirationDate','description');
//	initEditMode('#{messages['kala_desc']}','#{messages['kala_desc']}',mydata,false,'#sanadHesabdariGrid','#sanadHesabdariPcustbut',gridItems);


	$$('#sanadHesabdariGrid').jqGrid('hideCol','id'); 
	$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliID'); 

		}

	#{dwrFormName}.getSanadHesabdariItemList('#{owner.entity.id}',function(sanadHesabdariList){
		var gridItems=new Array('id','hesabTafsiliID','hesabTafsiliName','bestankar','bedehkar','description');
		var globalRowId = sanadHesabdariList.length;
		setGridGlobalRowId('sanadHesabdariGrid',globalRowId);
		
		var result = SetupSanadHesabdariJQgridJson(sanadHesabdariList,'#sanadHesabdariGrid',gridItems);
		
		createSanadHesabdariGrid(result);
	});

	function getBindedSanadHesabdariFieldId(fieldId){
		var bindedFieldId=fieldId;
		return bindedFieldId;
	}


	function updateSanadHesabdariField(fieldId,fieldValue){
		var bindedFieldId=getBindedSanadHesabdariFieldId(fieldId);
		$$('#'+bindedFieldId).val(fieldValue);
		fireEvent(document.getElementById(bindedFieldId),'change');
	}


	function addSanadHesabdariRowData(gridId){ 
		globalRowId = getGridGlobalRowId(gridId); 
		globalRowId++;
		$$(gridId).jqGrid('saveRow',lastRow, false, 'clientArray');

		var datarow = getSanadHesabdariDataRow(gridId);
		datarow['id']=globalRowId;
		var su=$$(gridId).jqGrid('addRowData',globalRowId,datarow);
		setGridGlobalRowId(gridId,globalRowId);
		if(su){
			addSanadHesabdariActionButtons(gridId,globalRowId);
			var lastPageNumber = getLastPageNumber(gridId);
			$$(gridId).jqGrid('setGridParam',{page:lastPageNumber}).trigger('reloadGrid'); 
		}else alert('Can not update');
	}




	
	function changeRowData(gridId,rowId){
		$$(gridId).jqGrid('saveRow',lastRow, false, 'clientArray');
		var datarow = getSanadHesabdariDataRow(gridId);
		var su=$$(gridId).jqGrid('setRowData',rowId,datarow); 
	}


	function getSanadHesabdariGridId(){
		return '#sanadHesabdariGrid';
	}

	
	
</script>
</html>
