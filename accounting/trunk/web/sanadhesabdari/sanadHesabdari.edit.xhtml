<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:custom="http://seraj.com/seraj/facelet"
	xmlns:t="http://myfaces.apache.org/tomahawk">

<ui:composition template="/template/template-edit.xhtml">
	<ui:param name="title" value="SanadHesabdari_edit_create" />
	<ui:param name="owner" value="#{sanadHesabdari}" />
	<ui:define name="fixsection">
	</ui:define>

	<ui:define name="scriptAndStyleSection">
		<link rel="stylesheet" type="text/css" href="${request.contextPath}/static/bootstrap/css/bootstrap.css?p=21" />
		<link rel="stylesheet" type="text/css" href="${request.contextPath}/static/bootstrap/css/bootstrap-responsive.css?p=21" />
		<script src="${request.contextPath}/static/bootstrap/js/bootstrap-modal.js"></script>
	</ui:define>
	<ui:define name="editsection">
		<script type="text/javascript">
		 /* <![CDATA[ */
 			var index=0;
			function addRow(itemID, hesabTafsiliID,hesabTafsiliName,hesabMoeenID,hesabMoeenName,bedehkar,bestankar,description){
				$$('#sanadItems > tbody:last').append(createNewRow(index++));
				setInputValue('item_id',index, itemID);
				setInputValue('hesab_tafsili_id',index, hesabTafsiliID);
				setInputValue('hesab_tafsili_name',index, hesabTafsiliName);
				setInputValue('hesab_moeen_id',index, hesabMoeenID);
				setInputValue('hesab_moeen_name',index, hesabMoeenName);
				setInputValue('bedehkar',index, bedehkar);
				setInputValue('bestankar',index, bestankar);
				setInputValue('description',index, description);
			}
			function createNewRow(){
				var pattern =/\[\d+\]/g;
				var replace='['+index+']';
				var newrow='<tr>'+tr.replace(pattern,replace)+'</tr>';
				return newrow;
			}
			function setInputValue(inputId, index, value){
				if(value!=null && value!='null')
					document.getElementById(inputId+'['+index+']').value =value;
			}
			function delRow(button){
				 $$(button).parent().parent().remove();
			}

			function openHesabModal(hesabTafsiliID, hesabTafsiliName, hesabMoeenID, hesabMoeenName){
				currentHesabTafsiliID =hesabTafsiliID;
				currentHesabTafsiliName =hesabTafsiliName;
				currentHesabMoeenID =hesabMoeenID;
				currentHesabMoeenName =hesabMoeenName;
				$$('#hesabLov').modal('show')
			}
			var currentHesabTafsiliID;
			var currentHesabTafsiliName;
			var currentHesabMoeenID;
			var currentHesabMoeenName;

			function selectHesabModal(tafsilId, tafsilName, moeenId, moeenName){
				document.getElementById(currentHesabTafsiliID).value=tafsilId;
				document.getElementById(currentHesabTafsiliName).value=tafsilName;
				document.getElementById(currentHesabMoeenID).value=moeenId;
				document.getElementById(currentHesabMoeenName).value=moeenName;
				$$('#hesabLov').modal('hide')
			}
			function fromJSON(){
				var values = document.getElementById('items').value || '';
				if(values!=''){
					items = JSON.parse(values);
					for(var key in items){
						var row=items[key];
						addRow(row['itemID'],row['hesabTafsiliID'],row['hesabTafsiliName'],row['hesabMoeenID'],row['hesabMoeenName'],row['bedehkar'],row['bestankar'],row['description']);
					}
				}
			}
			function toJSON(){
				var data={};
				for(i=1;i<=index;i++){
					var row={};
					if(getValue('hesab_tafsili_id',i)!=''){
						row['itemID']=getValue('item_id',i);
						row['hesabTafsiliID']=getValue('hesab_tafsili_id',i);
						row['hesabTafsiliName']=getValue('hesab_tafsili_name',i);
						row['hesabMoeenID']=getValue('hesab_moeen_id',i);
						row['hesabMoeenName']=getValue('hesab_moeen_name',i);
						row['bedehkar']=getValue('bedehkar',i);
						row['bestankar']=getValue('bestankar',i);
						row['description']=getValue('description',i);
						data[i]=row;
					}
				}
				document.getElementById('items').value=JSON.stringify(data);
			}
			function getValue(inputId, index){
				return document.getElementById(inputId+'['+index+']').value || '';
			}
			var tr;
			$$(function(){ 
				tr = $$('#sanadItems tbody>tr:last').clone(true).html();
				$$('#sanadItems tbody>tr:last').remove();
				fromJSON();
				if(index ==0){
					addRow('','','','','','','','');
					addRow('','','','','','','','');
				}
			});		
			 /* ]]> */
		</script>

		<rich:panel
			style="width: 100%; border-color: RGB(188,190,192); background-color: RGB(248,249,250);">
			<t:inputHidden id="items" value="#{sanadHesabdari.items}" forceId="true"/>
			<t:panelGrid columns="2" width="90%"
				columnClasses="viewLableCol,inputCol,viewLableCol,inputCol"
				styleClass="inputForm">

				<h:panelGroup>
					<h:outputLabel for="type" value="#{messages['SaalMaali_saal']}" /> : 
				</h:panelGroup>
				<h:selectOneMenu value="#{sanadHesabdari.entity.saalMaali.id}" 
					label="#{messages['SaalMaali_saal']}" id="SaalMaali_saal">
					<f:selectItems value="#{saalMaali.activeSaalList}" />
				</h:selectOneMenu>

				<h:panelGroup>
					<h:outputText styleClass="required" value="* " />
					<h:outputLabel for="number" value="#{messages['Sanad_number']}" /> : 
				</h:panelGroup>
				<h:inputText required="true" id="number" label="number"
					value="#{sanadHesabdari.entity.number}" />

				<h:panelGroup>
					<h:outputText styleClass="required" value="* " />
					<h:outputLabel for="tarikhSanad" value="#{messages['SanadHesabdari_tarikhSanad']}" /> : 
				</h:panelGroup>
				<custom:DateTimePicker type="Date" required="true" id="tarikhSanad"
					value="#{sanadHesabdari.entity.tarikhSanad}" lang="Shamsi"></custom:DateTimePicker>

				<h:panelGroup>
					<h:outputLabel for="sanadType" value="#{messages['SanadHesabdari_sanadType']}" /> : 
				</h:panelGroup>
				<h:selectOneMenu value="#{sanadHesabdari.entity.sanadType.id}" 
					label="#{messages['SanadHesabdari_sanadType']}" id="type" converter="javax.faces.Long">
					<f:selectItems value="#{entities.sanadType}" />
				</h:selectOneMenu>
				
				
				

				<h:panelGroup>
					<h:outputText styleClass="required" value="* " />
					<h:outputLabel for="description" value="#{messages['Sanad_description']}" /> : 
				</h:panelGroup>
				<h:inputText required="true" id="description" label="#{messages['Sanad_description']}"
					value="#{sanadHesabdari.entity.description}" style="width:400px"/>

			</t:panelGrid>
			<div style="margin:10px">
				<table id="sanadItems" class="table-striped table-bordered table-condensed" style="font-family: Tahoma">
					<thead>
						<tr>
							<th>#{messages['SanadItem_hesabTafsili']}</th>
							<th>#{messages['SanadItem_hesabMoeen']}</th>
							<th>#{messages['SanadItem_bedehkar']}</th>
							<th>#{messages['SanadItem_bestankar']}</th>
							<th>#{messages['SanadItem_description']}</th>
							<th>#{messages['SanadItem_delete']}</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
								<input type="hidden" name="item_id[0]"  id="item_id[0]"  value=""/>
								<input type="hidden" name="hesab_tafsili_id[0]"  id="hesab_tafsili_id[0]"  value=""/>
								<input type="text" name="hesab_tafsili_name[0]"  id="hesab_tafsili_name[0]" style="width:200px" placeholder="#{messages['SanadItem_selectHesab']}"  value="" onfocus="openHesabModal('hesab_tafsili_id[0]','hesab_tafsili_name[0]','hesab_moeen_id[0]','hesab_moeen_name[0]')"/>
							</td>
							<td>
								<input type="hidden" name="hesab_moeen_id[0]"  id="hesab_moeen_id[0]"  value=""/>
								<input type="text" name="hesab_moeen_name[0]"  id="hesab_moeen_name[0]" style="width:200px" readonly="readonly"/>
							</td>
							<td><input type="text" name="bedehkar[0]" id="bedehkar[0]"  value="" style="width:100px"/></td>
							<td><input type="text" name="bestankar[0]" id="bestankar[0]" value="" style="width:100px"/></td>
							<td><input type="text" name="description[0]" id="description[0]"  value="" style="width:300px"/></td>
							<td><input type="image" src="${request.contextPath}/images/remove.png" onclick="delRow(this);" class="btn btn-small"/></td>
						</tr>
					</tbody>
				</table>
				<input type="button" value="#{messages['SanadItem_add']}" onclick="addRow('','','','','','','','')" class="btn"/>
			</div>
		</rich:panel>
	    <div style="width:700px" class="modal hide" id="hesabLov">
		    <div class="modal-header">
			    <a class="close" data-dismiss="modal" style="margin:0 5px 0 15px"><img src="${request.contextPath}/images/remove.png" border="0"/></a>
			    <h3>#{messages['HesabTafsili_list']}</h3>
		    </div>
		    <div class="modal-body">
			   <iframe width="100%" frameborder="0"  height="350" src="${request.contextPath}/hesabtafsili/hesabTafsili.lov.modal.jsf">
			   
			   </iframe>
		    </div>
		    <div class="modal-footer">
		    </div>
	    </div>    
	</ui:define>
	<ui:define name="buttonsection">
		<h:commandButton styleClass=" gwt-Button" immediate="true"
			process="serajForm:newReturnUrl" rendered="#{owner.backable}"
			action="#{owner.back}" value="#{messages['common_list']}" />
	</ui:define>
</ui:composition>

</html>
