<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	
	
	xmlns:custom="http://seraj.com/seraj/facelet"
	xmlns:t="http://myfaces.apache.org/tomahawk" 
	xmlns:p="http://primefaces.org/ui">



<script type='text/javascript'	src='${request.contextPath}/common/sanadHesabdari.grid.js?p=24'> </script>
<script type='text/javascript'	src='${request.contextPath}/common/sanadHesabdari.gridNew.advanced.js?p=24'> </script>
<style>
.ui-autocomplete {
  position: absolute;
 }
</style>
<script type="text/javascript">

/* <![CDATA[ */

	//this function is used without jsf tag
    function createAutocomplete(id,src, minLength){
		$$('#'+id+'_desc').autocomplete({
			minLength: minLength,
			source: src,
			focus: function(event, ui) {
				//$$('#'+id+'_desc').val(ui.item.label);
				return false;
			},
			select: function(event, ui) {
				//alert('select');
				$$('#'+id+'_id').val(ui.item.value);
				$$('#'+id+'_desc').val(ui.item.label);
				//alert('ddddddddd');
				//element = document.getElementById(id+'_id');
				
				//this statement cause onchange event to be fired
				//$$('#'+id+'_desc').blur();
				//fireEvent(element,"change");
				//eval("evalOnselect"+id+"()");
				return false;
			},
			change: function(event, ui) {
				//alert('change');
			}			
		});
	}
	
	    function createRootHesabsAutocomplete(id,src, minLength){
		$$('#'+id+'_desc').autocomplete({
			minLength: minLength,
			source: src,
			appendTo: '#rootHesabsBodyDiv',
			focus: function(event, ui) {
				//$$('#'+id+'_desc').val(ui.item.label);
				return false;
			},
			select: function(event, ui) {
				//alert('select');
				debugger;
				$$('#'+id+'_id').val(ui.item.value);
				$$('#'+id+'_desc').val(ui.item.label);
				fireRootHesabsOnChange();
				//element = document.getElementById(id+'_id');
				
				//this statement cause onchange event to be fired
				//$$('#'+id+'_desc').blur();
				//fireEvent(element,"change");
				//eval("evalOnselect"+id+"()");
				return false;
			},
			change: function(event, ui) {
				//alert('change');
			}			
		});
	}
		var hesabTafsilisOne;
		var hesabTafsilisTwo;
		 $$(function() {
			$$.ajax({
				  url: '${request.contextPath}/entities?entity=HesabTafsili&property=desc&all=true&autocomplete=true&isHierarchical=true&tafsiliLevel=1',
				  cache: false,
				  success: function(result){
				    hesabTafsilisOne=result;
				  },
				  error: function(jqXHR, textStatus, errorThrown){
						alert(errorThrown);
					}
			});

			$$.ajax({
				  url: '${request.contextPath}/entities?entity=HesabTafsili&property=desc&all=true&autocomplete=true&isHierarchical=true&tafsiliLevel=2',
				  cache: false,
				  success: function(result){
				    hesabTafsilisTwo=result;
				  },
				  error: function(jqXHR, textStatus, errorThrown){
						alert(errorThrown);
					}
			});			
       	});
		/*var hesabTafsilis;
		function populateHesabTafsiliInputs(hesabTafsiliMap){
			//hesabTafsilis=result;
			$$('input.tafsiliInput').each(function( i ) {
				var id_desc = $( this ).prop('id');
				var id = id_desc.substring(0,id_desc.lastIndexOf("_desc"));
				createAutocomplete(id,hesabTafsiliMap,'0');	
			});	
		}*/
       	/*$$(function() {
			$$.ajax({
				  url: '${request.contextPath}/entities?entity=HesabTafsili&property=desc&all=true&autocomplete=true&isHierarchical=true&level=1&isShenavar=true',
				  cache: false,
				  success: function(result){
				    hesabTafsilis=result;
					populateHesabTafsiliInputs(hesabTafsilis);
				  },
				  error: function(jqXHR, textStatus, errorThrown){
						alert(errorThrown);
					}
			});
       	});*/ 
       	$$(function() {
			$$.ajax({
				  url: '${request.contextPath}/jersey/accountingRestFace/getRootHesabsMap',
				  cache: false,
				  success: function(result){
					
					var inpId = 'rootHesabs_id';
					var componentName='rootHesabs';
					var inputText = $$('<input type="text" class="form-control"  style="font-family:Tahoma;float:right;width:200px"/>').prop('id','rootHesabs_desc');
					var inputHidden = $$('<input type="hidden"  style="font-family:Tahoma;float:right;width:200px"/>').prop('id','rootHesabs_id');
					var inputClear = $$('<button onclick="clearAutocomplete(\''+componentName+'\');return false;" id="'+componentName+'_clearAutocomplete" class="clearAutocomplete"  tabindex="-1">');

					//$$(inputText).prop('class','m2mInput tafsiliInput');
					//$$(inputHidden).attr('onchange','alert(\'aaaa\');fireRootHesabsOnChange();');
					$$('#rootHesabsBodyDiv').append(inputText);
					$$('#rootHesabsBodyDiv').append(inputHidden);
					$$('#rootHesabsBodyDiv').append(inputClear);
					$$('#rootHesabsBodyDiv').append('<br/>');
					createRootHesabsAutocomplete('rootHesabs',result,'0');	
				  },
				  error: function(jqXHR, textStatus, errorThrown){
						alert(errorThrown);
					}
			});
   		});   

       	/*$$(function() {
			$$.ajax({
				  url: '${request.contextPath}/entities?entity=AccountingMarkaz&property=desc&all=true&autocomplete=true&isHierarchical=true&level=1',
				  cache: false,
				  success: function(result){
					$$('input.accountingMarkazInput').each(function( i ) {
						var id_desc = $( this ).prop('id');
						var id = id_desc.substring(0,id_desc.lastIndexOf("_desc"));
						createAutocomplete(id,result,'0');	
					});					    
				  },
				  error: function(jqXHR, textStatus, errorThrown){
						alert(errorThrown);
					}
			});
   		});    	*/

 
/* ]]> */
</script>			
<style>
	.paddingzero{
		//padding-right: 0 !important;
		//padding-left: 0 !important;
	}
</style>
<t:div id="sanadHesabdariDialog" style="display:none">
	<p:panelGrid columns="6" layout="grid" width="90%"
		columnClasses="viewLableColResponsive paddingzero ui-grid-col-3,inputCol paddingzero ui-grid-col-9, viewLableColResponsive paddingzero ui-grid-col-3,inputCol ui-grid-col-9,viewLableColResponsive paddingzero ui-grid-col-3,inputCol ui-grid-col-9, viewLableColResponsive paddingzero ui-grid-col-3,inputCol ui-grid-col-9" styleClass="inputForm  ">

		<h:panelGroup>
			<h:outputText value="#{messages['HesabKol_title']}: " />
		</h:panelGroup>
		<h:panelGroup>
			
			<p:inputText name="hesabKolName" id="hesabKolName" style="width:200px;" readonly="true"/>			
		</h:panelGroup>

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="hesabMoeen" value="#{messages['HesabMoeen_title']}: " />
		</h:panelGroup>
		<h:panelGroup>
			<custom:autocomplete-one id="hesabMoeen" entity="HesabMoeen" property="desc"
				onchange="fillDesthesabTafsiliOne('hesabMoeen','hesabTafsiliOne');fillDesthesabTafsiliTwo('hesabMoeen','hesabTafsiliTwo');fillDestMarkazAccountingByMoeen('hesabMoeen','accountingMarkaz');" client="true" 
				 onclear="fillDesthesabTafsiliOne('hesabMoeen','hesabTafsiliOne');fillDesthesabTafsiliTwo('hesabMoeen','hesabTafsiliTwo');fillDestMarkazAccountingByMoeen('hesabMoeen','accountingMarkaz');"
				extraParams="isHierarchical=true" width="200px" />
		</h:panelGroup>

		<h:panelGroup> 
			<h:outputText styleClass="required" value="  " />
			<h:outputLabel  value="#{messages['HesabTafsili_One']}: " />
		</h:panelGroup>
		<h:panelGroup>
			<custom:autocomplete-one id="hesabTafsiliOne" entity="HesabTafsili" property="desc"
				width="200px" client="true" extraParams="isHierarchical=true&amp;&amp;tafsiliLevel=1" onchange="showMoeenList('hesabMoeen','hesabTafsiliOne');"/>
		</h:panelGroup>
		
		<h:panelGroup> 
			<h:outputText styleClass="required" value="  " />
			<h:outputLabel  value="#{messages['HesabTafsili_Two']}: " />
		</h:panelGroup>
		<h:panelGroup>
			<custom:autocomplete-one id="hesabTafsiliTwo" entity="HesabTafsili" property="desc"
				width="200px" client="true" extraParams="isHierarchical=true&amp;&amp;tafsiliLevel=2" onchange="showMoeenList('hesabMoeen','hesabTafsiliTwo');"/>
		</h:panelGroup>



		<h:panelGroup> 
			<h:outputText styleClass="required" value="  " />
			<h:outputLabel  value="#{messages['AccountingMarkaz_title']}: " />
		</h:panelGroup>
		<h:panelGroup>
			<custom:autocomplete-one id="accountingMarkaz" entity="accountingMarkaz" property="name"
				width="200px" client="true" extraParams="isHierarchical=true"/>
		</h:panelGroup>


		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="bedehkar"
				value="#{messages['SanadHesabdariItem_bedehkar']}: " />
		</h:panelGroup>
		<p:inputText name="bedehkar" id="bedehkar" style="width:200px;"/>			

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="bestankar"
				value="#{messages['SanadHesabdariItem_bestankar']}: " />
		</h:panelGroup>
		<p:inputText name="bestankar" id="bestankar" style="width:200px;"/>					

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="description"
				value="#{messages['SanadHesabdariItem_description']}: " />
		</h:panelGroup>
		<p:inputTextarea name="description" id="description" rows="5" cols="30"/>					
		<h:panelGroup/>
		<h:panelGroup/>


	</p:panelGrid>
</t:div>

<table id="sanadHesabdariGrid">
	<tr>
		<td>&nbsp;</td>
	</tr>
	
</table>
<div id="buttons" style="text-align: center;padding: 5px;">
	<button type="button" class="btn btn-success" onclick="openArticleDialogu();"  style="font-family: yekan;"><i class="glyphicon glyphicon-plus position-left"></i> #{messages['common_new']} </button>
	<button type="button" class="btn btn-success" data-toggle="modal" data-target="#rootHesabsDIV" style="font-family: yekan;"><i class="glyphicon glyphicon-plus position-left"></i> #{messages['SanadHesabdari_newRootHesab']} </button>
</div>

<div id="sanadHesabdariPcustbut"></div>

		
<div id="rootHesabsDIV" class="modal fade"  role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-body form-horizontal">
				<fieldset class="content-group">
					<legend class="text-bold">اطلاعات آرتیکل</legend>

					<div class="form-group">
						<label class="control-label col-lg-2">حساب</label>
						<div id="rootHesabsBodyDiv" class="col-lg-10">
							
						</div>
					</div>
									
					<div class="form-group">
						<label class="control-label col-lg-2">شرح آرتیکل</label>
						<div class="col-lg-10">
							<textarea id="articleDescription" rows="5" cols="5" class="form-control" placeholder=""></textarea>				
						</div>
					</div>				
				</fieldset>				
			</div>

			<div class="modal-footer">
			</div>
		</div>
	</div>
</div>


<div id="tafsiliMoeenDIV">
	<table id="tafsiliMoeenTable">
	</table>
</div>


<t:jsValueSet name="tafsiliMoeenMap" value="#{hesabTafsili.tafsiliMoeenMap}" />
<t:jsValueSet name="kolMoeenMap" value="#{hesabKol.kolMoeenMap}" />
<t:jsValueSet name="moeenKolMap" value="#{hesabMoeen.moeenKolMap}" />

<t:jsValueSet name="moeenTafsiliOneMap"	value="#{hesabMoeen.moeenTafsiliOneMap}" />
<t:jsValueSet name="moeenTafsiliTwoMap"	value="#{hesabMoeen.moeenTafsiliTwoMap}" />
<t:jsValueSet name="moeenAccountingMarkazMap"	value="#{hesabMoeen.accountingMarkazMap}" />
<t:jsValueSet name="tafsiliChildMap"	value="#{hesabTafsili.tafsiliChildMap}" rendered="false"/>
<t:jsValueSet name="tafsiliAccountingMarkazChildMap"	value="#{hesabTafsili.tafsiliAccountingMarkazChildMap}" rendered="false"/>
<t:jsValueSet name="accountingMarkazChildMap"	value="#{accountingMarkaz.accountingMarkazChildMap}" rendered="false" />

<script type="text/javascript">

/* <![CDATA[ */

		function fillDesthesabTafsiliOne(moeen,tafsili){
			var moeenId = $$('#hesabMoeen_id').val();
			
			if(moeenId == null || moeenId == ''){
				//alert('==null');
				$$('#'+tafsili+'_desc').autocomplete('option','source','<ul></ul>');
				clearAutocomplete(tafsili);
				$$('#hesabKolName').val('');
				renderOne(tafsili,hesabTafsilisOne,'0');	
				return;
			}
			clearAutocomplete(tafsili);
			tafsiliMap = moeenTafsiliOneMap[moeenId];
			//alert(inspect(tafsiliMap,10,10));
			kolMap = moeenKolMap[moeenId];
			//alert("unitMap : "+unitMap.length);
			//var filtered = tafsiliMap;
			//alert(inspect(filtered,10,10));
			$$('#'+tafsili+'_desc').autocomplete('option','source',tafsiliMap);
			 $$('#hesabKolName').val(kolMap.label);
			 //$$('#hesabTafsili_desc').autocomplete({source:filtered});
		}

		
		function fillDesthesabTafsiliTwo(moeen,tafsili){
			var moeenId = $$('#hesabMoeen_id').val();
			
			if(moeenId == null || moeenId == ''){
				//alert('==null');
				$$('#'+tafsili+'_desc').autocomplete('option','source','<ul></ul>');
				clearAutocomplete(tafsili);
				$$('#hesabKolName').val('');
				renderOne(tafsili,hesabTafsilisTwo,'0');	
				return;
			}
			clearAutocomplete(tafsili);
			tafsiliMap = moeenTafsiliTwoMap[moeenId];
			//alert(inspect(tafsiliMap,10,10));
			kolMap = moeenKolMap[moeenId];
			//alert("unitMap : "+unitMap.length);
			//var filtered = tafsiliMap;
			//alert(inspect(filtered,10,10));
			$$('#'+tafsili+'_desc').autocomplete('option','source',tafsiliMap);
			 $$('#hesabKolName').val(kolMap.label);
			 //$$('#hesabTafsili_desc').autocomplete({source:filtered});
		}
		function fillDestMarkazAccountingByMoeen(moeen,accountingMarkaz){
			//return; //must be corrected in future
			//debugger;
			clearAutocomplete(accountingMarkaz);
			//alert('fillDestMarkazAccountingByMoeen : '+accountingMarkaz);
			var moeenId = $$('#hesabMoeen_id').val();
			//alert('moeenId : '+moeenId);
			if(moeenId == null || moeenId == '')
				return;
			clearAutocomplete(accountingMarkaz);
			accountingMarkazMap = moeenAccountingMarkazMap[moeenId];
			//alert("unitMap : "+unitMap.length);
			var filtered = accountingMarkazMap;
			//alert(inspect(filtered,10,10));
			 $$('#'+accountingMarkaz+'_desc').autocomplete('option','source',filtered);
			 //$$('#hesabAccountingMarkaza_desc').autocomplete({source:filtered});
		}


		
$$(document).ready(function() {
	$$('[id="bedehkar"]').digitize();
	$$('[id="bestankar"]').digitize();
});
	


		 

		setGridGlobalRowId('#sanadHesabdariGrid',0);
		var lastRow = -1; 
		function createSanadHesabdariGrid(xmlData) { 		
			$$('#sanadHesabdariGrid')
			.jqGrid(
					{
						direction :'rtl',
			            datatype: 'xmlstring',
			            datastr: xmlData,
						height: '100%',
						editurl: 'clientArray',
						colNames : [
									'#{messages['common_id']}', 
									'hesabKolID', 
									'#{messages['SanadHesabdariItem_hesabKol']}', 
									'hesabMoeenID', 
									'#{messages['SanadHesabdariItem_hesabMoeen']}', 
									'hesabTafsiliID', 
									'#{messages['HesabTafsili_One']}', 
									'hesabTafsiliTwoID', 
									'#{messages['HesabTafsili_Two']}',
									'accountingMarkazID', 
									'#{messages['SanadHesabdariItem_accountingMarkaz']}', 
									'markazHazineID', 
									'#{messages['MarkazHazine_title']}',
									'#{messages['common_id']}', 
									'#{messages['Project_title']}',
									'#{messages['SanadHesabdariItem_bedehkar']}', 
									'#{messages['SanadHesabdariItem_bestankar']}', 
									'#{messages['SanadHesabdariItem_description']}', 
									'#{messages['common_delete']}', 
									'#{messages['common_edit']}' 
									],
						colModel : [
							{name :'id', index :'id', width :2, sorttype :'int'}, 
							{name :'hesabKolID', index :'hesabKolID', width :2, sorttype :'string'}, 
							{name :'hesabKolName', index :'hesabKolName', width :174, sorttype :'string'}, 
							{name :'hesabMoeenID', index :'hesabMoeenID', width :2, sorttype :'string'}, 
							{name :'hesabMoeenName', index :'hesabMoeenName', width :175, sorttype :'string'}, 
							{name :'hesabTafsiliOneID', index :'hesabTafsiliOneID', width :20, sorttype :'string'}, 
							{name :'hesabTafsiliOneName', index :'hesabTafsiliOneName', width :150, sorttype :'string'}, 
							{name :'hesabTafsiliTwoID', index :'hesabTafsiliTwoID', width :20, sorttype :'string'}, 
							{name :'hesabTafsiliTwoName', index :'hesabTafsiliTwoName', width :150, sorttype :'string'}, 
							{name :'accountingMarkazID', index :'accountingMarkazID', width :20, sorttype :'string'}, 
							{name :'accountingMarkazName', index :'accountingMarkazName', width :50, sorttype :'string'}, 
							{name :'markazHazineID', index :'markazHazineID', width :2, sorttype :'string'}, 
							{name :'markazHazineName', index :'markazHazineName', width :100, sorttype :'string'},
							{name :'projectID', index :'projectID', width :2, sorttype :'string'}, 
							{name :'projectName', index :'projectName', width :100, sorttype :'string'},
							{name :'bedehkar', index :'bedehkar', width :150, sortable :false, editable:true,formatter: numberFormatter}, 
							{name :'bestankar', index :'bestankar', width :150, sortable :false, editable:true,formatter: numberFormatter}, 
							{name :'description', index :'description', width :150, sortable :false, editable:true}, 
							{name :'act', index :'act', width :30, sortable :false, formatter:urlFormatter}
							{name :'editAct', index :'editAct', width :30, sortable :false, formatter:urlFormatter}
						],
						autowidth: true, 
						shrinkToFit: true,
						multiselect :false,
						viewrecords: true, 
						pager: '#sanadHesabdariPcustbut',
						rowNum:1000, 
						rownumbers: true,
						sortname: 'moeenName', 
						onSelectRow: function(id){ 
							//alert(id);
							$$('#sanadHesabdariGrid').jqGrid('editRow',id,true);
							if(lastRow != -1)if(id!=lastRow)
								$$('#sanadHesabdariGrid').jqGrid('saveRow',lastRow, false, 'clientArray');
							lastRow=id;   
							//$$('#sanadHesabdariGrid').jqGrid('setSelection', id, true);
						}, 
						ondblClickRow: function(rowId) {
							clearSanadHesabdariDialog('#sanadHesabdariGrid');
							if(lastRow != -1)if(rowId!=lastRow)
								$$('#sanadHesabdariGrid').jqGrid('saveRow',lastRow, false, 'clientArray');
							lastRow=rowId; 
							//alert(selectedRowId);
							editSanadHesabdariRowData('#sanadHesabdariGrid', rowId ,'#{messages['common_edit']}');						
						},
						gridComplete : function(){ 
							//alert('gridComplete');
							var firstRowId=$$("#sanadHesabdariGrid").getDataIDs()[0];
							 $$('#sanadHesabdariGrid').jqGrid('setSelection', firstRowId, true);
							 lastRow=firstRowId; 
							 //alert($$("#sanadHesabdariGrid").getDataIDs()[0]);
						},
						caption :'#{messages['SanadHesabdariItem_list']}',
						footerrow : true, 
						userDataOnFooter : true
					});
		$$('#sanadHesabdariGrid').jqGrid('navGrid','#sanadHesabdariPcustbut',{edit:false,add:false,del:false,search:false,page:false, searchtext:'#{messages['common_search']}'}); 
/*		$$('#sanadHesabdariGrid').jqGrid('navButtonAdd','#sanadHesabdariPcustbut',{caption:'#{messages['common_new']}', buttonicon:"ui-icon-circle-plus",  
				onClickButton:function(){ 
						openArticleDialogu();
				} 
			});
		$$('#sanadHesabdariGrid').jqGrid('navButtonAdd','#sanadHesabdariPcustbut',{caption:'#{messages['SanadHesabdari_newRootHesab']}', 
			onClickButton:function(){
				
				$$('#rootHesabsDIV').modal('toggle');
				
			}
		});*/
	$$("#sanadHesabdariGrid").jqGrid('bindKeys', {"onEnter":function( rowid ) { editSanadHesabdariRowData("#sanadHesabdariGrid",rowid,"Edit"); return false;} } );

	$$('#sanadHesabdariGrid').jqGrid('hideCol','id'); 
	$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabKolID'); 	
	$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliLevels'); 
	$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliDescs'); 
	$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabMoeenID'); 
	$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliOneID'); 
	$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliTwoID');
	$$('#sanadHesabdariGrid').jqGrid('hideCol','markazHazineID');
	$$('#sanadHesabdariGrid').jqGrid('hideCol','markazHazineName');
	$$('#sanadHesabdariGrid').jqGrid('hideCol','projectID');
	$$('#sanadHesabdariGrid').jqGrid('hideCol','projectName');

	//$$('#sanadHesabdariGrid').jqGrid('hideCol','accountingMarkazLevelNames'); 
	$$('#sanadHesabdariGrid').jqGrid('hideCol','accountingMarkazID'); 
	
	
	updateFooter();

		$$('#rootHesabsDIV').on('shown.bs.modal', function () {
			$$('#rootHesabs_desc').focus();
		})
	}


	

	function openArticleDialogu(){
		clearSanadHesabdariDialog('#sanadHesabdariGrid');
		$$('#sanadHesabdariDialog').dialog({position: { my: "top", at: "top", of: window  }
		, title:'#{messages['SanadHesabdariItem_title']}', width: '100%',modal: true, autoOpen: true,close: function() {$$(this).off('keydown');} ,buttons: { '#{messages['common_close']}': function() { $$(this).dialog('close'); },'#{messages['common_add']}': function() { addSanadHesabdariRowData('#sanadHesabdariGrid'); }}});
		$$('#sanadHesabdariDialog').on('keydown', function(e) {
			
			 var code = (e.keyCode ? e.keyCode : e.which);
			 //alert(code);
			 if(code == 45) { //INS key adds article to sanadGrid
				//alert('new : 45');
				var result = addSanadHesabdariRowData('#sanadHesabdariGrid');
				$$('#sanadHesabdariGrid').jqGrid('setSelection', rowId, true);
				lastRow=rowId;
				$$('#sanadHesabdariGrid').focus();
				return false;
			 }
		});		
		$$('#hesabMoeen_desc').focus();	
	}
	
	function addSanadHesabdariRowData(gridId){
		globalRowId = getGridGlobalRowId(gridId); 
		globalRowId++;
		$$(gridId).jqGrid('saveRow',lastRow, false, 'clientArray');
		
		var datarow = getSanadHesabdariDataRow(gridId);
		datarow['id']=globalRowId;
		
	 	
	 	var bestankarVal=datarow['bestankar']+"";
		bestankarVal=bestankarVal.replace(/\,/g,'');
		var bedehkarVal=datarow['bedehkar']+"";
		bedehkarVal=bedehkarVal.replace(/\,/g,'');

		var descriptionVal=datarow['description']+"";
		
		if (!descriptionVal) {
			alert("#{messages['SanadHesabdariItem_descriptionIsRequired']}");
			return false;
		}
		
		if(!((parseFloat(bestankarVal)>=parseFloat(0)) &&(parseFloat(bedehkarVal)>=parseFloat(0)))){
			alert("#{messages['common_incorrent_number']}");
			return false;			
		}

		var su=$$(gridId).jqGrid('addRowData',globalRowId,datarow);
		setGridGlobalRowId(gridId,globalRowId);
		if(su){
			addSanadHesabdariActionButtons(gridId,globalRowId);
			var lastPageNumber = getLastPageNumber(gridId);
			$$(gridId).jqGrid('setGridParam',{page:lastPageNumber}).trigger('reloadGrid'); 
		}else alert('Can not update');

		updateFooter();

		$$('#sanadHesabdariGrid').jqGrid('setSelection', globalRowId, true);
		debugger;
		clearSanadHesabdariDialog('#sanadHesabdariGrid');
		
		$$('#hesabMoeen_desc').focus();
		var bestankarTotal= sumColumnOfGrid('sanadHesabdariGrid','bestankar');
		var bedehkarTotal= sumColumnOfGrid('sanadHesabdariGrid','bedehkar');
		if(bestankarTotal == bedehkarTotal)
			$$('#sanadHesabdariDialog').dialog('close');
		
	}



	
	

	
	function changeRowData(gridId,rowId){
		$$(gridId).jqGrid('saveRow',lastRow, false, 'clientArray');
		$$('#sanadHesabdariGrid').jqGrid('setSelection', rowId, true);
		var datarow = getSanadHesabdariDataRow(gridId);
		
	 	var bestankarVal=datarow['bestankar']+"";
		bestankarVal=bestankarVal.replace(/\,/g,'');
		var bedehkarVal=datarow['bedehkar']+"";
		bedehkarVal=bedehkarVal.replace(/\,/g,'');
		
		var descriptionVal=datarow['description']+"";
		
		if (!descriptionVal) {
			alert("#{messages['SanadHesabdariItem_descriptionIsRequired']}");
		    return false;
		}
		
		//alert(!((parseFloat(bestankarVal)>=parseFloat(0)) &&(parseFloat(bedehkarVal)>=parseFloat(0))));
		if(!((parseFloat(bestankarVal)>=parseFloat(0)) &&(parseFloat(bedehkarVal)>=parseFloat(0)))){
			alert("#{messages['common_incorrent_number']}");
			return false;
		}

		var su=$$(gridId).jqGrid('setRowData',rowId,datarow); 
		updateFooter();	
   		$$('#sanadHesabdariDialog').dialog('close');
		return true;
	}


	function getSanadHesabdariGridId(){
		return '#sanadHesabdariGrid';
	}


	$$(window).bind('resize', function() {
		resize();
	}).trigger('resize');

	function getSanadHesabdariDataRow(gridId){
		debugger;
		var datarow={};
		var localItems = getItems(gridId);
		for ( var j = 0; j < localItems.length; j++){
			var fieldId = localItems[j];
			
			
			var convertedFieldId = getBindedSanadHesabdariFieldId(fieldId);
			var val = $$('#'+convertedFieldId).val();
			if(fieldId == 'bedehkar' && val == '')
				val =0;
			if(fieldId == 'bestankar' && val == '')
				val =0;
			datarow[fieldId]=val;
		}
		
		return datarow;
	}	
	/* ]]> */
</script>
</html>
