<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	
	
	xmlns:custom="http://seraj.com/seraj/facelet"
	xmlns:t="http://myfaces.apache.org/tomahawk" 
	xmlns:p="http://primefaces.org/ui">


			
		<script type='text/javascript'	src='${request.contextPath}/dwr/interface/#{dwrFormName}.js?p=23'> </script>
		<script type='text/javascript'	src='${request.contextPath}/common/sanadHesabdari.gridNew.js?p=23'> </script>
<style>
.dialogViewLableCol {
	text-align: left;
	width: 33%;
	vertical-align: middle;
	font-family: tahoma;
	color: gray;
	font-size: 12px;
	padding-left: 10px;
}

</style>

<t:div id="sanadHesabdariDialog" forceId="true" style="display:none">
	<p:panelGrid columns="2" layout="grid" width="90%"
		columnClasses="viewLableColResponsive ui-grid-col-3,inputCol ui-grid-col-9" styleClass="inputForm  ">

		<h:panelGroup>
			<h:outputText value="#{messages['HesabKol_title']}" />
		</h:panelGroup>
		<h:panelGroup>
			<input name="hesabKolName" id="hesabKolName" readonly="readonly" style="width:220px"/>
		</h:panelGroup>

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="hesabMoeen" value="#{messages['HesabMoeen_title']}" /> : 
		</h:panelGroup>
		<h:panelGroup>
			<custom:autocomplete-one id="hesabMoeen" entity="HesabMoeen" property="name"
				width="220px" onchange="fillDest('hesabMoeen','hesabTafsili')" client="true" extraParams="isHierarchical=true"/>
		</h:panelGroup>

		<h:panelGroup> 
			<h:outputText styleClass="required" value="  " />
			<h:outputLabel  value="#{messages['HesabTafsili_title']}" /> : 
		</h:panelGroup>
		<h:panelGroup>
			<custom:autocomplete-one id="hesabTafsili" entity="HesabTafsili" property="name"
				width="220px" client="true" extraParams="isCurrentOrgan=true" onchange="showMoeenList('hesabMoeen','hesabTafsili')"/>
		</h:panelGroup>
		

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="bedehkar"
				value="#{messages['SanadHesabdariItem_bedehkar']}" /> : 
		</h:panelGroup>
		<input type="text" style="width: 200px;" name="bedehkar" id="bedehkar" />

		<h:panelGroup>
			<h:outputText styleClass="required" value="* " />
			<h:outputLabel for="bestankar" value="#{messages['SanadHesabdariItem_bestankar']}" /> : 
		</h:panelGroup>
		<input type="text" style="width: 200px;" name="bestankar" id="bestankar" />




		<h:panelGroup>
			<h:outputText styleClass="required" value="  " />
			<h:outputLabel for="description" value="#{messages['SanadHesabdariItem_description']}" /> : 
		</h:panelGroup>
		<textarea  name="description" id="description" rows="5"  style="width: 200px;"/>
			

	</p:panelGrid>
</t:div>
 
<table id="sanadHesabdariGrid">
	<tr>
		<td>&nbsp;</td>
	</tr> 
</table>
<div id="sanadHesabdariPcustbut"></div>

<div id="tafsiliMoeenDIV" style="display:none;">
	<table id="tafsiliMoeenTable" style="width:350px">
	</table>
</div>

<t:jsValueSet name="tafsiliMoeenMap" value="#{hesabTafsili.tafsiliMoeenMap}" />
<t:jsValueSet name="kolMoeenMap" value="#{hesabKol.kolMoeenMap}" />
<t:jsValueSet name="moeenKolMap" value="#{hesabMoeen.moeenKolMap}" />
<t:jsValueSet name="moeenTafsiliMap" value="#{hesabMoeen.moeenTafsiliMap}" />
<input type="text" style="width: 30px;display: none;"     name="sanadInputTempEdit" id="sanadInputTempEdit" />
<script type="text/javascript">

/* <![CDATA[ */
    function isNumeric(n) {
  			return !isNaN(parseFloat(n)) && isFinite(n);
		}           



		
		function setTafsili(id,desc){
			document.getElementById("hesabTafsiliName").value=desc;
			document.getElementById("hesabTafsiliID").value=id;
			$$('#hesabLov').modal('hide');
		}
		 

		setGridGlobalRowId('#sanadHesabdariGrid',0);
		var lastRow = -1; 
		function createSanadHesabdariGrid(xmlData) { 		
			$$('#sanadHesabdariGrid')
			.jqGrid(
					{
						direction :'rtl',
			            datatype: 'xmlstring',
			            datastr: xmlData,
						height: '100%',
			            shrinkToFit: true,
						colNames : [
									'#{messages['common_id']}', 
									'#{messages['common_id']}', 
									'#{messages['SanadHesabdariItem_hesabKol']}', 
									'#{messages['common_id']}', 
									'#{messages['SanadHesabdariItem_hesabMoeen']}', 
									'#{messages['common_id']}', 
									'#{messages['SanadHesabdariItem_hesabTafsili']}', 
									'#{messages['common_id']}', 
									'', 
									'', 
									'#{messages['MarkazHazine_title']}',
									'#{messages['common_id']}', 
									'#{messages['Project_title']}',
									'#{messages['SanadHesabdariItem_bedehkar']}', 
									'#{messages['SanadHesabdariItem_bestankar']}', 
									'#{messages['SanadHesabdariItem_description']}', 
									'#{messages['common_delete']}', 
									'#{messages['common_edit']}' 
									],
						colModel : [ 
							{name :'id', index :'id', width :2, sorttype :'int'}, 
							{name :'hesabKolID', index :'hesabKolID', width :2, sorttype :'string'}, 
							{name :'hesabKolName', index :'hesabKolName', width :100, sorttype :'string'}, 
							{name :'hesabMoeenID', index :'hesabMoeenID', width :2, sorttype :'string'}, 
							{name :'hesabMoeenName', index :'hesabMoeenName', width :100, sorttype :'string'}, 
							{name :'hesabTafsiliID', index :'hesabTafsiliID', width :2, sorttype :'string'}, 
							{name :'hesabTafsiliName', index :'hesabTafsiliName', width :200, sorttype :'string'}, 
							{name :'hesabTafsiliLevels', index :'hesabTafsiliLevels', width :1, sorttype :'string'}, 
							{name :'hesabTafsiliDescs', index :'hesabTafsiliDescs', width :1, sorttype :'string'}, 
							{name :'markazHazineID', index :'markazHazineID', width :2, sorttype :'string'}, 
							{name :'markazHazineName', index :'markazHazineName', width :100, sorttype :'string'},
							{name :'projectID', index :'projectID', width :2, sorttype :'string'}, 
							{name :'projectName', index :'projectName', width :100, sorttype :'string'},
							{name :'bedehkar', index :'bedehkar', width :100, sortable :false, editable:true}, 
							{name :'bestankar', index :'bestankar', width :100, sortable :false, editable:true}, 
							{name :'description', index :'description', width :150, sortable :false, editable:true}, 
							{name :'act', index :'act', width :30, sortable :false}, 
							{name :'editAct', index :'editAct', width :45, sortable :false}
						],
						multiselect :false,
						viewrecords: true, 
						autowidth: true, 
						pager: '#sanadHesabdariPcustbut',
						rowNum:50, 
						rownumbers: true,
						sortname: 'moeenName', 
						/*onSelectRow: function(id){ 
							$$('#sanadHesabdariGrid').jqGrid('editRow',id,true);
							if(lastRow != -1)if(id!=lastRow)
								$$('#sanadHesabdariGrid').jqGrid('saveRow',lastRow, false, 'clientArray');
							lastRow=id;   
						},*/ 
						caption :'#{messages['SanadHesabdariItem_list']}',
						footerrow : true, 
						userDataOnFooter : true
					});
		$$('#sanadHesabdariGrid').jqGrid('navGrid','#sanadHesabdariPcustbut',{edit:false,add:false,del:false,search:false,page:false, searchtext:'#{messages['common_search']}'}); 
		$$('#sanadHesabdariGrid').jqGrid('navButtonAdd','#sanadHesabdariPcustbut',{caption:'#{messages['common_new']}', buttonicon:"ui-icon-circle-plus",  
			onClickButton:function(){ 
				clearSanadHesabdariDialog('#sanadHesabdariGrid');
				$$('#sanadHesabdariDialog').dialog({title:'#{messages['SanadHesabdariItem_title']}', width: '60%', autoOpen: true,close: function() {$$(this).off('keydown');} ,buttons: { '#{messages['common_close']}': function() { $$(this).dialog('close'); },'#{messages['common_add']}': function() { addSanadHesabdariRowData('#sanadHesabdariGrid');$$(this).dialog('close'); }}});
				$$('#sanadHesabdariDialog').on('keydown', function(e) {
					
					 var code = (e.keyCode ? e.keyCode : e.which);
					 //alert(code);
					 if(code == 45) { //INS key adds article to sanadGrid
						//alert('new : 45');
							var result = addSanadHesabdariRowData('#sanadHesabdariGrid');
							if(result){
								clearSanadHesabdariDialog('#sanadHesabdariGrid');
								$$('#hesabMoeen_desc').focus();
								var bestankarTotal= sumColumnOfGrid('sanadHesabdariGrid','bestankar');
								var bedehkarTotal= sumColumnOfGrid('sanadHesabdariGrid','bedehkar');
								if(bestankarTotal == bedehkarTotal)
									$$('#sanadHesabdariDialog').dialog('close');
							}
						return false;
					 }
				});			
			} 
		});
		$$("#sanadHesabdariGrid").jqGrid('bindKeys', {"onEnter":function( rowid ) { editSanadHesabdariRowData("#sanadHesabdariGrid",rowid,"Edit")} } );
	
	
		$$('#sanadHesabdariGrid').jqGrid('hideCol','id'); 
		$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliID'); 
		$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabKolID'); 
		$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabMoeenID'); 
		$$('#sanadHesabdariGrid').jqGrid('hideCol','markazHazineID');
		$$('#sanadHesabdariGrid').jqGrid('hideCol','markazHazineName');
		$$('#sanadHesabdariGrid').jqGrid('hideCol','projectID');
		$$('#sanadHesabdariGrid').jqGrid('hideCol','projectName');
		$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliLevels');
		$$('#sanadHesabdariGrid').jqGrid('hideCol','hesabTafsiliDescs');
		
		
		updateFooter();

	}

		
	 

	
	function createSanadHesabdariTable(sanadHesabdariXML){
		var gridItems=new Array('id','hesabKolID','hesabKolName','hesabMoeenID','hesabMoeenName','hesabTafsiliID','hesabTafsiliName','hesabTafsiliLevels','hesabTafsiliDescs','markazHazineID','markazHazineName','projectID','projectName','bedehkar','bestankar','description');
		setItems("#sanadHesabdariGrid",gridItems);
		createSanadHesabdariGrid(sanadHesabdariXML);
		var cnt = $$('#sanadHesabdariGrid').jqGrid('getGridParam', 'records');
		setGridGlobalRowId('#sanadHesabdariGrid',cnt);
	}
	
	function updateSanadHesabdariField(fieldId,fieldValue){
		var bindedFieldId=getBindedSanadHesabdariFieldId(fieldId);
		$$('#'+bindedFieldId).val(fieldValue);
		fireEvent(document.getElementById(bindedFieldId),'change');
	}

	
	function addSanadHesabdariRowData(gridId){ 
		globalRowId = getGridGlobalRowId(gridId); 
		globalRowId++;
		$$(gridId).jqGrid('saveRow',lastRow, false, 'clientArray');
		var datarow = getSanadHesabdariDataRow(gridId);
		datarow['id']=globalRowId;
		
	 	var bestankarVal=datarow['bestankar']+"";
		bestankarVal=bestankarVal.replace(/\,/g,'');
		var bedehkarVal=datarow['bedehkar']+"";
		bedehkarVal=bedehkarVal.replace(/\,/g,'');

		if((parseFloat(bestankarVal)>=parseFloat(0)) &&((parseFloat(bedehkarVal)>=parseFloat(0)))){
			var su=$$(gridId).jqGrid('addRowData',globalRowId,datarow);
			setGridGlobalRowId(gridId,globalRowId);
			if(su){
				addSanadHesabdariActionButtons(gridId,globalRowId);
				var lastPageNumber = getLastPageNumber(gridId);
				$$(gridId).jqGrid('setGridParam',{page:lastPageNumber}).trigger('reloadGrid'); 
			}else alert('Can not update');
			updateFooter();
			return true;
		}
		else{
			alert("#{messages['common_incorrent_number']}");
			return false;
		}
		
	}

		$$('[id="bedehkar"]').on('keyup', function(e) {
			$$(this).digits();
		});	
		$$('[id="bestankar"]').on('keyup', function(e) {
			$$(this).digits();
		});	
		

	function editSanadHesabdariRowData(gridId,rowId,title){
		$$(gridId).jqGrid('saveRow',lastRow, false, 'clientArray');
		var su=$$(gridId).getRowData(rowId);

		var localItems = getItems(gridId);
		for ( var j = 0; j < localItems.length; j++){
			updateSanadHesabdariField(localItems[j],su[localItems[j]]);
		}
		$$('#sanadHesabdariDialog').dialog({title:title, width: '60%', autoOpen: true,close: function() {$$(this).off('keydown');} ,buttons: { '#{messages['common_close']}': function() { $$(this).dialog('close'); },'#{messages['common_update']}': function() { changeRowData(gridId,rowId);$$(this).dialog('close'); }}});
		$$('#sanadHesabdariDialog').on('keydown', function(e) {
			
			 var code = (e.keyCode ? e.keyCode : e.which);
			 //alert(code);
			 if(code == 113) { //F2 key updates article in sanadGrid
			   //alert('edit : 113');
				 var result = changeRowData(gridId,rowId);
				 if(result){
			   		$$('#sanadHesabdariDialog').dialog('close');
				 }
			   return false;
			 }
			 if(code == 45) { //INS key adds article to sanadGrid
				//alert('new : 45');
				var result = addSanadHesabdariRowData('#sanadHesabdariGrid');
				if(result){
					clearSanadHesabdariDialog('#sanadHesabdariGrid');
					$$('#hesabMoeen_desc').focus();
				}
				return false;
			 }			 
		});		
			
		
		return false;
	}

	
	

	
	function changeRowData(gridId,rowId){
		$$(gridId).jqGrid('saveRow',lastRow, false, 'clientArray');
		var datarow = getSanadHesabdariDataRow(gridId);
		
	 	var bestankarVal=datarow['bestankar']+"";
		bestankarVal=bestankarVal.replace(/\,/g,'');
		var bedehkarVal=datarow['bedehkar']+"";
		bedehkarVal=bedehkarVal.replace(/\,/g,'');
		
		if((parseFloat(bestankarVal)>=parseFloat(0)) &&((parseFloat(bedehkarVal)>=parseFloat(0)))){
			var su=$$(gridId).jqGrid('setRowData',rowId,datarow); 
			updateFooter();	
			return true;
		}
		else{
			alert("#{messages['common_incorrent_number']}");
			return false;
		}
		
	
	}


	function getSanadHesabdariGridId(){
		return '#sanadHesabdariGrid';
	}


	
	/* ]]> */
</script>
</html>
